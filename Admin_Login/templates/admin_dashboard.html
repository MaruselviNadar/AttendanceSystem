<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background-color: #f5f7f4;
        background-image: url("{{ url_for('static', filename='innerheadercommon.jpg') }}");
        background-repeat: no-repeat;
        background-position: top center;
        background-size: contain;
      }

      .wrapper {
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 60px;
      }

      .required {
        color: red;
        margin-left: 4px;
      }
      .highlight-id {
        background-color: #fff3cd;
        border: 2px solid #ff9800;
        font-weight: bold;
        color: #b26a00;
        cursor: not-allowed;
      }

      .dashboard {
        width: 420px;
        background: white;
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        padding: 30px;
      }

      .section {
        display: none;
      }

      h2 {
        text-align: center;
        color: #004a99;
        margin-bottom: 20px;
      }

      .btn {
        width: 100%;
        padding: 14px;
        margin-top: 12px;
        border: none;
        border-radius: 8px;
        background: #004a99;
        color: white;
        font-size: 15px;
        font-weight: bold;
        cursor: pointer;
      }

      .btn:hover {
        background: #003366;
      }

      .back {
        background: #666;
      }

      label {
        margin-top: 10px;
        display: block;
        font-weight: bold;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background: #004a99;
        color: white;
        padding: 8px;
      }

      td {
        padding: 8px;
        text-align: center;
      }
      .alert-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 9999;
      }

      .alert-box {
        background: white;
        width: 320px;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin: 15% auto;
      }

      .alert-buttons {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        gap: 10px;
      }

      .alert-buttons button {
        padding: 8px 18px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }

      #alertOk {
        background: #0b5ed7;
        color: white;
      }

      #alertCancel {
        background: #6c757d;
        color: white;
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <div class="dashboard">
        <img
          src="{{ url_for('static', filename='sieslogo.jpg') }}"
          alt="Logo"
        />

        <!-- MAIN MENU -->
        <div id="mainMenu">
          <h2>Welcome Admin</h2>
          <button class="btn" onclick="showTeacherMenu()">
            Teacher Management
          </button>
          <button class="btn" onclick="showStudentMenu()">
            Student Management
          </button>
        </div>

        <!-- TEACHER MENU -->
        <div id="teacherMenu" class="section">
          <h2>Teacher Management</h2>
          <button class="btn" onclick="showAddTeacher()">Add Teacher</button>
          <button class="btn" onclick="showViewTeacher()">View Teachers</button>
          <button class="btn" onclick="showDeleteTeacher()">
            Delete Teachers
          </button>
          <button class="btn" onclick="showAssignSubject()">
            Map Subject To Teacher
          </button>
          <button class="btn" onclick="showAssignClassTeacher()">
            Assign Class Teacher
          </button>
          <button class="btn" onclick="showAddSubject()">Add Subject</button>

          <button class="btn back" onclick="goBack()">Back</button>
        </div>

        <!-- STUDENT MENU -->
        <div id="studentMenu" class="section">
          <h2>Student Management</h2>
          <button class="btn" onclick="showAddStudent()">Add Student</button>
          <button class="btn" onclick="showViewStudent()">View Students</button>
          <button class="btn" onclick="showDeleteStudent()">
            Delete Student
          </button>
          <button class="btn back" onclick="goBack()">Back</button>
        </div>

        <!-- ADD TEACHER -->
        <div id="addTeacher" class="section">
          <h2>Add Teacher</h2>
          <label>Name<span class="required">*</span></label
          ><input id="tname" required />
          <label>Department<span class="required">*</span></label>
          <select id="tdept" required>
            <option value="">Select Department</option>
            <option value="CS">Computer Science</option>
            <option value="BSCIT">Information Technology</option>
          </select>
          <label>Teacher ID<span class="required">*</span></label
          ><input id="tid" />
          <label>Password<span class="required">*</span></label
          ><input type="password" id="tpass" required />
          <button class="btn" onclick="saveTeacher()">Save</button>
          <!--<button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>
        <!-- UPDATE TEACHER -->
        <div id="updateTeacher" class="section">
          <h2>Update Teacher</h2>

          <label>Name</label>
          <input id="utname" />

          <label>Department</label>
          <select id="utdept">
            <option value="CS">Computer Science</option>
            <option value="BSCIT">Information Technology</option>
          </select>

          <label>Teacher ID</label>
          <input id="utid" readonly class="highlight-id" />

          <button class="btn" onclick="updateTeacher()">Update</button>
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>

        <!-- VIEW TEACHERS -->
        <div id="viewTeacher" class="section">
          <h2>Teachers</h2>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Department</th>
                <th>ID</th>
              </tr>
            </thead>
            <tbody id="teacherTable"></tbody>
          </table>
          <!--<button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>

        <!-- DELETE TEACHER -->
        <div id="deleteTeacher" class="section">
          <h2>Delete Teacher</h2>
          <!--<select id="deleteList"></select>-->
          <select id="deleteList">
            <option disabled selected>Select teacher</option>
            {% for teacher in teachers %}
            <option value="{{ teacher.teacher_id }}">{{ teacher.name }}</option>
            {% endfor %}
          </select>
          <button class="btn" onclick="deleteTeacherData()">Delete</button>
          <!--<button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>

        <!-- ASSIGN SUBJECT -->
        <div id="assignSubject" class="section">
          <h2>Map subject to teacher</h2>

          <label>Teacher<span class="required">*</span></label>
          <select id="as_teacher" required></select>

          <label>Stream<span class="required">*</span></label>
          <select id="as_stream" required>
            <option value="">Select</option>
            <option value="BSCIT">Information Technology</option>
            <option value="CS">Computer Science</option>
          </select>

          <label>Year<span class="required">*</span></label>
          <select id="as_year" required onchange="updateSemesters()">
            <option value="">Select</option>
            <option value="1">First Year</option>
            <option value="2">Second Year</option>
            <option value="3">Third Year</option>
          </select>

          <label>Semester<span class="required">*</span></label>
          <select id="as_semester" required>
            <option value="">Select</option>
          </select>

          <label>Subject<span class="required">*</span></label>
          <select id="as_subject" required></select>

          <button class="btn" onclick="assignSubject()">Assign</button>
          <!-- <button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>
        <!-- ASSIGN CLASS TEACHER -->
        <div id="assignClassTeacher" class="section">
          <h2>Assign Class Teacher</h2>

          <label>Teacher<span class="required">*</span></label>
          <select id="ct_teacher" required></select>

          <label>Stream<span class="required">*</span></label>
          <select id="ct_stream" required>
            <option value="">Select</option>
            <option value="BSCIT">Information Technology</option>
            <option value="CS">Computer Science</option>
          </select>

          <label>Year<span class="required">*</span></label>
          <select id="ct_year" required>
            <option value="">Select</option>
            <option value="1">First Year</option>
            <option value="2">Second Year</option>
            <option value="3">Third Year</option>
          </select>

          <label>Academic Year<span class="required">*</span></label>
          <input id="ct_academic_year" required />

          <button class="btn" onclick="assignClassTeacher()">Assign</button>
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>

        <!-- ADD SUBJECT -->
        <div id="addSubject" class="section">
          <h2>Add Subject</h2>

          <label>Subject Name<span class="required">*</span></label>
          <input id="sub_name" />

          <label>Stream<span class="required">*</span></label>
          <select id="sub_stream">
            <option value="">Select</option>
            <option value="BSCIT">Information Technology</option>
            <option value="CS">Computer Science</option>
          </select>

          <label
            >Year<span class="required" "
              >*</span
            ></label
          >
          <select id="sub_year" required >
            <option value="">Select</option>
            <option value="1">First Year</option>
            <option value="2">Second Year</option>
            <option value="3">Third Year</option>
          </select>

          <label>Semester<span class="required">*</span></label>
          <select id="sub_semester">
            <option value="">Select</option>
          </select>

          <button class="btn" onclick="saveSubject()">Save</button>
          <button class="btn back" onclick="goBackToTeacherMenu()">Back</button>
        </div>

        <!-- ADD STUDENT -->
        <div id="addStudent" class="section">
          <h2>Add Student</h2>
          <label>Student Name<span class="required">*</span></label>
          <input id="sname" required />
          <label>Department<span class="required">*</span></label>
          <select id="sdept" required>
            <option value="">Select Department</option>
            <option value="CS">Computer Science</option>
            <option value="BSCIT">Information Technology</option>
          </select>
          <label>Year<span class="required">*</span></label>
          <select id="syear" required>
            <option value="">Select Year</option>
            <option value="1">First Year</option>
            <option value="2">Second Year</option>
            <option value="3">Third Year</option>
          </select>
          <label>Roll No<span class="required">*</span></label
          ><input id="sroll" required />
          <label>Password<span class="required">*</span></label
          ><input type="password" id="spass" required />
          <button class="btn" onclick="saveStudent()">Save</button>
          <!--<button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToStudentMenu()">Back</button>
        </div>

        <!-- VIEW STUDENTS -->
        <div id="viewStudent" class="section">
          <h2>Students</h2>
          <label>Department:</label>
          <select id="filterDept" onchange="filterStudents()">
            <option value="">All</option>
            <option value="BSCIT">Information Technology</option>
            <option value="CS">Computer Science</option>
          </select>

          <label style="margin-top: 10px">Year:</label>
          <select id="filterYear" onchange="filterStudents()">
            <option value="">All</option>
            <option value="1">First Year</option>
            <option value="2">Second Year</option>
            <option value="3">Third Year</option>
          </select>

          <br /><br />

          <table>
            <thead>
              <tr>
                <th>Department</th>
                <th>Year</th>
                <th>Roll no.</th>
              </tr>
            </thead>
            <tbody id="studentTable"></tbody>
          </table>
          <!-- <button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToStudentMenu()">Back</button>
        </div>

        <!-- DELETE STUDENT -->
        <div id="deleteStudent" class="section">
          <h2>Delete Student</h2>
          <select id="deleteStudentList"></select>
          <button class="btn" onclick="deleteStudentData()">Delete</button>
          <!--  <button class="btn back" onclick="goBack()">Back</button>-->
          <button class="btn back" onclick="goBackToStudentMenu()">Back</button>
        </div>
      </div>
    </div>

    <script>
      let selectedStudentRoll = null;

      const $ = (id) => document.getElementById(id);
      function openUpdateTeacher(id, name, dept) {
        hideAll();
        $("updateTeacher").style.display = "block";

        utid.value = id;
        utname.value = name;
        utdept.value = dept;
      }

      function hideAll() {
        [
          "mainMenu",
          "teacherMenu",
          "studentMenu",
          "addTeacher",
          "viewTeacher",
          "deleteTeacher",
          "addStudent",
          "viewStudent",
          "deleteStudent",
          "assignSubject",
          "assignClassTeacher",
          "addSubject",
          "updateTeacher",
        ].forEach((id) => ($(id).style.display = "none"));
      }

      function goBack() {
        hideAll();
        $("mainMenu").style.display = "block";
      }
      function goBackToMain() {
        hideAll();
        $("mainMenu").style.display = "block";
      }

      function goBackToTeacherMenu() {
        hideAll();
        $("teacherMenu").style.display = "block";
      }

      function goBackToStudentMenu() {
        hideAll();
        $("studentMenu").style.display = "block";
      }
      function showTeacherMenu() {
        hideAll();
        $("teacherMenu").style.display = "block";
      }
      function showStudentMenu() {
        hideAll();
        $("studentMenu").style.display = "block";
      }

      function showAddTeacher() {
        hideAll();
        $("addTeacher").style.display = "block";
      }
      function showViewTeacher() {
        hideAll();
        $("viewTeacher").style.display = "block";
        loadTeachers();
      }
      //function showDeleteTeacher(){ hideAll(); $("deleteTeacher").style.display="block"; loadTeacherDelete(); }
      function showDeleteTeacher() {
        hideAll();
        $("deleteTeacher").style.display = "block";

        // âœ… force reload every time
        deleteList.innerHTML = "";
        loadTeacherDelete();
      }
      function showAssignSubject() {
        hideAll();
        $("assignSubject").style.display = "block";
        loadAssignTeachers();
      }

      function showAddSubject() {
        hideAll();
        $("addSubject").style.display = "block";
      }

      function showAddStudent() {
        hideAll();
        $("addStudent").style.display = "block";
      }
      function showViewStudent() {
        hideAll();
        $("viewStudent").style.display = "block";
        loadStudents();
      }
      //function showDeleteStudent(){ hideAll(); $("deleteStudent").style.display="block"; loadStudentDelete(); }
      function showDeleteStudent() {
        hideAll();
        $("deleteStudent").style.display = "block";

        // force refresh
        deleteStudentList.innerHTML = "";
        loadStudentDelete();
      }

      /*function saveTeacher(){
      fetch("/add_teacher",{method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name:tname.value,department:tdept.value,teacher_id:tid.value,password:tpass.value})})
      //.then(r=>r.json()).then(d=>alert(d.message));
      .then(r=>r.json())
      //.then(d=>showAlert(d.message,"green"));
      .then(d => {
          if(d.status === "success"){
              showAlert(d.message, "green");

              // optional: clear fields on success
              tname.value = "";
              tdept.value = "";
              tid.value = "";
              tpass.value = "";
          } else {
              showAlert(d.message, "red");
          }
      });


      }*/
      function updateSemesters() {
        console.log("Function called"); // ðŸ‘ˆ DEBUG LINE

        let year = document.getElementById("as_year").value;
        let semesterSelect = document.getElementById("as_semester");

        semesterSelect.innerHTML = '<option value="">Select</option>';

        if (year === "1") {
          addOption(semesterSelect, "1", "Sem I");
          addOption(semesterSelect, "2", "Sem II");
        } else if (year === "2") {
          addOption(semesterSelect, "3", "Sem III");
          addOption(semesterSelect, "4", "Sem IV");
        } else if (year === "3") {
          addOption(semesterSelect, "5", "Sem V");
          addOption(semesterSelect, "6", "Sem VI");
        }
      }

      function addOption(select, value, text) {
        let opt = document.createElement("option");
        opt.value = value;
        opt.text = text;
        select.appendChild(opt);
      }
      function saveTeacher() {
        const name = tname.value.trim();
        const dept = tdept.value.trim();
        const id = tid.value.trim();
        const pass = tpass.value.trim();

        const nameRegex = /^[A-Za-z\s]+$/;

        if (!nameRegex.test(name)) {
          showAlert("Name should contain only alphabets", "red");
          return;
        }

        /* âœ… 1. EMPTY FIELD CHECK */
        if (name === "" || dept === "" || id === "" || pass === "") {
          showAlert("Fill all the fields", "red");
          return; // â›” STOP here
        }

        /* âœ… 2. CALL BACKEND ONLY IF VALID */
        fetch("/add_teacher", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: name,
            department: dept,
            teacher_id: id,
            password: pass,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            if (d.status === "success") {
              showAlert(d.message, "green");
              tname.value = "";
              tdept.value = "";
              tid.value = "";
              tpass.value = "";
            } else {
              showAlert(d.message, "green");
            }
          });
      }

      function loadTeachers() {
        fetch("/get_teachers")
          .then((r) => r.json())
          .then((d) => {
            teacherTable.innerHTML = "";
            //d.forEach(t=>teacherTable.innerHTML+=`<tr><td>${t.name}</td><td>${t.department}</td><td>${t.teacher_id}</td></tr>`);
            if (d.length === 0) {
              teacherTable.innerHTML = `
                      <tr>
                          <td colspan="4" style="text-align:center">No teachers available</td>
                      </tr>
                  `;
              return;
            }

            d.forEach((t) => {
              let star =
                t.is_class_teacher === "YES"
                  ? " <span class='required'>â˜…</span>"
                  : "";
              teacherTable.innerHTML += `
      <tr>
        <td>${t.name}${star}</td>
        <td>${t.department}</td>
        <td>${t.teacher_id}</td>
        <td>
          <button class="btn" style="padding:6px"
            onclick="openUpdateTeacher('${t.teacher_id}','${t.name}','${t.department}')">
            Edit
          </button>
        </td>
      </tr>
      `;
            });
          });
      }

      function loadTeacherDelete() {
        fetch("/get_teachers")
          .then((r) => r.json())
          .then((d) => {
            //deleteList.innerHTML="";
            deleteList.innerHTML = `<option disabled selected>Select teacher</option>`;

            if (d.length === 0) {
              deleteList.innerHTML = "<option>No teachers available</option>";
              return;
            }
            //d.forEach(t=>deleteList.innerHTML+=`<option value="${t.teacher_id}">${t.name}</option>`);
            d.forEach((t) => {
              deleteList.innerHTML += `<option value="${t.teacher_id}">${t.name}</option>`;
            });
          });
      }

      /*function deleteTeacherData(){
      fetch("/delete_teacher",{method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({teacher_id:deleteList.value})})
      //.then(r=>r.json()).then(d=>alert(d.message));
      .then(r=>r.json())
      .then(d=>showAlert(d.message,"green"));

      }*/
      /*function deleteTeacherData(){
          fetch("/delete_teacher",{
              method:"POST",
              headers:{"Content-Type":"application/json"},
              body: JSON.stringify({ teacher_id: deleteList.value })
          })
          .then(r => r.json())
          .then(d => {
              showAlert(d.message, "green");

              loadTeacherDelete();   // âœ… refresh dropdown
              loadTeachers();        // âœ… refresh view table
          });
      }
      */
      /*function deleteTeacherData() {
          const id = deleteList.value?.trim();  // âœ… trim spaces

          if(!id || id === "Select teacher" || id === "No teachers available"){
              showAlert("No teacher selected", "red");
              return;
          }

          showDeleteAlert(
              "Are you sure you want to delete this teacher?",
              id
          );

          fetch("/delete_teacher", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ teacher_id: id })
          })
          .then(r => r.json())
          .then(d => {
              if(d.success){
                  showAlert(d.message, "green");

                  // âœ… remove deleted teacher from dropdown
                  deleteList.querySelector(`option[value="${id}"]`)?.remove();

                  // âœ… refresh teachers table
                  loadTeachers();

                  // âœ… handle empty dropdown
                  if(deleteList.options.length === 1){ // only default option left
                      deleteList.innerHTML = `<option disabled selected>No teachers available</option>`;
                  }
              } else {
                  showAlert(d.message, "red");
              }
          })
          .catch(err => {
              console.error("Delete error:", err);
              showAlert("Delete failed", "red");
          });
      }
      */

      function deleteTeacherData() {
        const id = deleteList.value?.trim();

        if (!id || id === "Select teacher" || id === "No teachers available") {
          showAlert("No teacher selected", "red");
          return;
        }

        // âœ… ONLY open confirmation popup
        showDeleteAlert("Are you sure you want to delete this teacher?", id);
      }

      function loadAssignTeachers() {
        fetch("/api/teachers")
          .then((r) => r.json())
          .then((data) => {
            as_teacher.innerHTML = '<option value="">Select Teacher</option>';
            data.forEach((t) => {
              as_teacher.innerHTML += `
                      <option value="${t.teacher_id}">
                          ${t.teacher_name} (${t.teacher_id})
                      </option>`;
            });
          });
      }

      /* Load subjects */
      function loadAssignSubjects() {
        if (!as_stream.value || !as_year.value || !as_semester.value) return;

        fetch(
          `/api/subjects?stream=${as_stream.value}&year=${as_year.value}&semester=${as_semester.value}`,
        )
          .then((r) => r.json())
          .then((data) => {
            as_subject.innerHTML = '<option value="">Select Subject</option>';
            data.forEach((s) => {
              as_subject.innerHTML += `<option value="${s.id}">${s.subject_name}</option>`;
            });
          });
      }

      as_stream.onchange = loadAssignSubjects;
      as_year.onchange = function () {
        updateSemesters();
        loadAssignSubjects;
      };
      as_semester.onchange = loadAssignSubjects;

      /* Assign subject */
      function assignSubject() {
        /*  if(!as_teacher.value || !as_subject.value){
              alert("Please select all fields");
              return;

          }
      */ if (!as_teacher.value || !as_subject.value) {
          showAlert("Please select all fields");
          return;
        }

        fetch("/api/assign-subject", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            teacher_id: as_teacher.value,
            subject_id: as_subject.value,
            stream: as_stream.value,
            year: as_year.value,
            semester: as_semester.value,
          }),
        })
          .then((r) => r.json())
          // .then(d=>alert(d.message));
          .then((d) => {
            showAlert(d.message, "green");
            as_teacher.value = "";
            as_stream.value = "";
            as_year.value = "";
            as_semester.value = "";
            as_subject.innerHTML = '<option value="">Select Subject</option>';
          });
      }
      //assign class teacher
      function showAssignClassTeacher() {
        hideAll();
        $("assignClassTeacher").style.display = "block";

        fetch("/api/teachers")
          .then((r) => r.json())
          .then((data) => {
            ct_teacher.innerHTML = '<option value="">Select Teacher</option>';
            data.forEach((t) => {
              ct_teacher.innerHTML += `
                      <option value="${t.teacher_id}">
                          ${t.teacher_name}
                      </option>`;
            });
          });
      }

      function assignClassTeacher() {
        if (
          !ct_teacher.value ||
          !ct_stream.value ||
          !ct_year.value ||
          !ct_academic_year.value
        ) {
          showAlert("Fill all fields", "red");
          return;
        }

        fetch("/api/assign-class-teacher", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            teacher_id: ct_teacher.value,
            stream: ct_stream.value,
            year: ct_year.value,
            academic_year: ct_academic_year.value,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            showAlert(d.message, "green");
            ct_teacher.value = "";
            ct_stream.value = "";
            ct_year.value = "";
            ct_academic_year.value = "";
          });
      }

      function updateTeacher() {
        const name = utname.value.trim();
        const dept = utdept.value.trim();
        const id = utid.value.trim();

        const nameRegex = /^[A-Za-z\s]+$/;

        if (!nameRegex.test(name)) {
          showAlert("Name should contain only alphabets", "red");
          return;
        }

        if (name === "" || dept === "") {
          showAlert("Fields cannot be empty");
          return;
        }

        fetch("/update_teacher", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: name,
            department: dept,
            teacher_id: id,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            showAlert(d.message, "green");
            showViewTeacher(); // reload table
          });
      }

      //add subject
      function saveSubject() {
        const name = sub_name.value.trim();
        const stream = sub_stream.value;
        const year = sub_year.value;
        const semester = sub_semester.value;

        if (!name || !stream || !year || !semester) {
          showAlert("Fill all the fields", "red");
          return;
        }

        fetch("/add_subject", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            subject_name: name,
            stream: stream,
            year: year,
            semester: semester,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            showAlert(d.message, d.status === "success" ? "green" : "red");

            if (d.status === "success") {
              sub_name.value = "";
              sub_stream.value = "";
              sub_year.value = "";
              sub_semester.value = "";
            }
          });
      }

      sub_year.onchange = function () {
  let year = sub_year.value;
  sub_semester.innerHTML = '<option value="">Select</option>';

  if (year === "1") {
    addOption(sub_semester, "1", "Sem I");
    addOption(sub_semester, "2", "Sem II");
  } 
  else if (year === "2") {
    addOption(sub_semester, "3", "Sem III");
    addOption(sub_semester, "4", "Sem IV");
  } 
  else if (year === "3") {
    addOption(sub_semester, "5", "Sem V");
    addOption(sub_semester, "6", "Sem VI");
  }
};

      /*function saveStudent(){

      fetch("/add_student",{method:"POST",headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
          name: sname.value,
          department: sdept.value,
          year: syear.value,
          roll_no: sroll.value,
          password: spass.value
      })
      })
      //.then(r=>r.json()).then(d=>alert(d.message));
      .then(r=>r.json())
      .then(d=>showAlert(d.message,"green"));

      }
      */
      function saveStudent() {
        const name = sname.value.trim();
        const dept = sdept.value.trim();
        const year = syear.value.trim();
        const roll = sroll.value.trim();
        const pass = spass.value.trim();

        // âœ… FRONTEND VALIDATION
        if (
          name === "" ||
          dept === "" ||
          year === "" ||
          roll === "" ||
          pass === ""
        ) {
          showAlert("Fill all the fields", "red");
          return; // â›” STOP execution
        }

        fetch("/add_student", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: name,
            department: dept,
            year: year,
            roll_no: roll,
            password: pass,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            if (d.status === "success") {
              showAlert(d.message, "green");

              // clear form
              sname.value = "";
              sdept.value = "";
              syear.value = "";
              sroll.value = "";
              spass.value = "";
            } else {
              showAlert(d.message, "red");
            }
          });
      }

      function loadStudents() {
        fetch("/get_students")
          .then((r) => r.json())
          .then((d) => {
            studentTable.innerHTML = "";
            if (d.length === 0) {
              studentTable.innerHTML = `
                      <tr>
                          <td colspan="3" style="text-align:center">No students available</td>
                      </tr>
                  `;
              return;
            }
            d.forEach(
              (s) =>
                (studentTable.innerHTML += `<tr><td>${s.department}</td><td>${s.year}</td><td>${s.roll_no}</td></tr>`),
            );
          });
      }

      function loadStudentDelete() {
        fetch("/get_students")
          .then((r) => r.json())
          .then((d) => {
            deleteStudentList.innerHTML = "";
            if (d.length === 0) {
              deleteStudentList.innerHTML =
                "<option>No students available</option>";
              return;
            }
            d.forEach(
              (s) =>
                (deleteStudentList.innerHTML += `<option value="${s.roll_no}">${s.roll_no}</option>`),
            );
          });
      }

      /*function deleteStudentData(){
      fetch("/delete_student",{method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({roll_no:deleteStudentList.value})})
      //.then(r=>r.json()).then(d=>alert(d.message));
      .then(r=>r.json())
      .then(d=>showAlert(d.message,"green"));

      }*/

      //delete Student
      function deleteStudentData() {
        const roll = deleteStudentList.value;

        if (!roll) {
          showAlert("No student selected", "red");
          return;
        }

        selectedStudentRoll = roll;

        showDeleteAlert("Do you really want to delete this student?", roll);
      }

      hideAll();
      $("mainMenu").style.display = "block";
      /* function showAlert(msg){
          document.getElementById("alertText").innerText = msg;
          document.getElementById("customAlert").style.display = "flex";
      } */
      /*function showAlert(msg, color="red"){
          const t = document.getElementById("alertText");
          t.style.color = "";
          t.innerText = msg;
          t.style.color = color ;
          document.getElementById("customAlert").style.display = "flex";
      }*/
      function showAlert(msg, color = "red") {
        const t = document.getElementById("alertText");

        t.innerText = msg;

        // ðŸ”¥ FORCE COLOR (cannot be overridden)
        t.style.setProperty("color", color, "important");

        document.getElementById("customAlert").style.display = "flex";
      }

      function closeAlert() {
        document.getElementById("customAlert").style.display = "none";
      }

      //filter students
      function filterStudents() {
        const dept = document.getElementById("filterDept").value;
        const year = document.getElementById("filterYear").value;

        const rows = document.querySelectorAll("#studentTable tr");

        rows.forEach((row) => {
          const rowDept = row.cells[0]?.innerText;
          const rowYear = row.cells[1]?.innerText;

          if (
            (dept === "" || rowDept === dept) &&
            (year === "" || rowYear === year)
          ) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }
    </script>
    <!-- Custom Alert Box -->
    <div
      id="customAlert"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: center;
        z-index: 9999;
      "
    >
      <div
        style="
          background: white;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          min-width: 280px;
        "
      >
        <!--<p id="alertText"></p>-->
        <!--<p id="alertText" style="color:red; font-size:16px;"></p>-->
        <p id="alertText" style="font-size: 16px"></p>

        <button onclick="closeAlert()" class="btn">OK</button>
      </div>
    </div>
    <div id="showAlert" class="alert-overlay">
      <div class="alert-box">
        <p id="alertMessage"></p>
        <div class="alert-buttons">
          <button id="alertOk">OK</button>
          <button id="alertCancel">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      let selectedTeacherId = null;

      function showDeleteAlert(message, teacherId) {
        selectedTeacherId = teacherId;
        document.getElementById("alertMessage").innerText = message;
        document.getElementById("showAlert").style.display = "block";
      }

      function closeDeleteAlert() {
        document.getElementById("showAlert").style.display = "none";
      }

      document.getElementById("alertCancel").onclick = closeDeleteAlert;

      document.getElementById("alertOk").onclick = function () {
        // ðŸ”µ STUDENT DELETE
        if (selectedStudentRoll) {
          fetch("/delete_student", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ roll_no: selectedStudentRoll }),
          })
            .then((res) => res.json())
            .then((data) => {
              closeDeleteAlert();

              showAlert(data.message, "green");

              selectedStudentRoll = null;
              loadStudentDelete();
              loadStudents();
            });

          return;
        }

        // ðŸ”µ TEACHER DELETE
        if (selectedTeacherId) {
          fetch("/delete_teacher", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ teacher_id: selectedTeacherId }),
          })
            .then((res) => res.json())
            .then((data) => {
              closeDeleteAlert();

              if (data.status === "success") {
                showAlert(data.message, "green");
              } else {
                showAlert(data.message, "red");
              }

              selectedTeacherId = null;
              loadTeacherDelete();
              loadTeachers();
            });
        }
      };
    </script>
  </body>
</html>
